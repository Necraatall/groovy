/***********************enum test of big enums*************/

/*
1. def enum
2. def utills, testcase ID, teststep ID (next 1th one)
3. set property country[0]
4. run test step +1
5. def step list
6. if test step fail/Ok/UNKNOWN - defined by assertions 
7. run for cyclus for each in collection country
8. set country value by the list item from previous collection cyrcle
9. set country to some normal value
*/

import com.eviware.soapui.model.testsuite.Assertable.AssertionStatus
// firsthly def ArrayList - enums
// this enums is available for change if another enums will change, dont change another part of code
List<String> country = new ArrayList<String> (["MK", "AD", "AE", "AF"])
//, "AG", "AI", "AL", "AM", "AO", "AQ", "AR", "AS", "AT", "AU", "AW", "AX", "AZ", "BA", "BB", "BD", "BE", "BF", "BG", "BH", "BI", "BJ", "BL", "BM", "BN", "BO", "BQ", "BR", "BS", "BT", "BV", "BW", "BY", "BZ", "CA", "CC", "CD", "CF", "CG", "CI", "CK", "CL", "CM", "CN", "CO", "CR", "CU", "CV", "CW", "CX", "CY", "CZ", "DE", "DJ", "DK", "DM", "DO", "DZ", "EC", "EE", "EG", "EH", "ER", "ES", "ET", "FI", "FJ", "FK", "FM", "FO", "FR", "GA", "GB", "GD", "GE", "GF", "GG", "GH", "GI", "GL", "GM", "GN", "GP", "GQ", "GR", "GS", "GT", "GU", "GW", "GY", "HK", "HM", "HN", "HR", "HT", "HU", "CH", "ID", "IE", "IL", "IM", "IN", "IO", "IQ", "IR", "IS", "IT", "JE", "JM", "JO", "JP", "KE", "KG", "KH", "KI", "KM", "KN", "KP", "KR", "KW", "KY", "KZ", "LA", "LB", "LC", "LI", "LK", "LR", "LS", "LT", "LU", "LV", "LY", "MA", "MC", "MD", "ME", "MF", "MG", "MH", "ML", "MM", "MN", "MO", "MP", "MQ", "MR", "MS", "MT", "MU", "MV", "MW", "MX", "MY", "MZ", "NA", "NC", "NE", "NF", "NG", "NI", "NL", "NO", "NP", "NR", "NU", "NZ", "OM", "PA", "PE", "PF", "PG", "PH", "PK", "PL", "PM", "PN", "PR", "PS", "PT", "PW", "PY", "QA", "RE", "RO", "RS", "RU", "RW", "SA", "SB", "SC", "SD", "SE", "SG", "SH", "SI", "SJ", "SK", "SL", "SM", "SN", "SO", "SR", "SS", "ST", "SV", "SX", "SY", "SZ", "TC", "TD", "TF", "TG", "TH", "TJ", "TK", "TL", "TM", "TN", "TO", "TR", "TT", "TV", "TW", "TZ", "UA", "UG", "UM", "US", "UY", "UZ", "VA", "VC", "VE", "VG", "VI", "VN", "VU", "WF", "WS", "YE", "YT", "ZA", "ZM", "ZW"])

log.info "!!!!!!!Dont stop this Test Step!!!!!!!!!"
log.info "!!!!!!!Dont change this Test Step when run!!!!!!!!!"
log.info "!!!!!!!Wait for results at least 10 minutes!!!!!!!!!"

//def actual test Case and Test Step into MTD-ODS-ESB-Country-all (next one) 
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context );
def testCase = testRunner.testCase;
def testStep = testCase.getTestStepAt(context.currentStepIndex + 1);

//set property country with value item into TestCase
testRunner.testCase.setPropertyValue("country", country[0])
   //log.info testStep + ": " + country[0]
   
//now run test step (will be run by count of enum values)
testRunner = new com.eviware.soapui.impl.wsdl.testcase.WsdlTestCaseRunner(testCase, null);
testStepContext = new com.eviware.soapui.impl.wsdl.testcase.WsdlTestRunContext(testStep);
testStep.run(testRunner, testStepContext);

// here we detect if test case were failed (when is not firsth if, then list all assertion test steps in test case, is usable as Tear Down Script too)
def StepList = testCase.getTestStepList()

if (country != country[0] && country[0] != null){
	StepList.each{
    	  if(it==testStep){
    		if(it.metaClass.hasProperty(it,'assertionStatus')){
        		if(it.assertionStatus == AssertionStatus.FAILED){
            		log.error "${it.name} FAIL with value of: " + testRunner.testCase.getPropertyValue("country")
        			}
        			else if(it.assertionStatus == AssertionStatus.VALID){
            		log.info "${it.name} OK!"
            		
					// now loop arrayList value by value it means item and run it in Test step MTD-ESB-TLM-Country-all (next 1th test step)
					for (String item : country) {
						//set property country with value item into TestCase
						testRunner.testCase.setPropertyValue("country", item)
   						//log.info testStep + ": " + item
   						
						//now run test step (will be run by count of enum values)
						testRunner = new com.eviware.soapui.impl.wsdl.testcase.WsdlTestCaseRunner(testCase, null);
						testStepContext = new com.eviware.soapui.impl.wsdl.testcase.WsdlTestRunContext(testStep);
						testStep.run(testRunner, testStepContext);
					}
				log.info "All Country enum validations of Country for MasterData is correct in ESB."
        			}
        			else if(it.assertionStatus == AssertionStatus.UNKNOWN){
            			log.error "${it.name} UNKNOWN (PROBABLY NOT ALREADY EXECUTED) " + testRunner.testCase.getPropertyValue("country")
        			}
        		}
    		}
    }
}
// now set property in Test case into normal value for Hungary "HU"
testRunner.testCase.setPropertyValue("country", "HU")
